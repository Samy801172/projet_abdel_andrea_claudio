<div class="orders-container">
  <h2 class="text-2xl font-bold mb-6">Mes Commandes</h2>

  @if (isAdmin) {
    <div class="admin-controls mb-6">
      <input
        type="text"
        [(ngModel)]="searchTerm"
        placeholder="Rechercher une commande..."
        class="search-input"
      >
      <select [(ngModel)]="filterStatus" class="status-filter">
        <option value="">Tous les statuts</option>
        <option value="pending">En attente</option>
        <option value="processing">En cours</option>
        <option value="shipped">Expédiée</option>
        <option value="delivered">Livrée</option>
        <option value="cancelled">Annulée</option>
      </select>
    </div>
  }

  @if (orders.length === 0) {
    <div class="empty-state">
      <p>Aucune commande trouvée</p>
    </div>
  } @else {
    <div class="orders-list">
      @for (order of filteredOrders; track order.id_order) {
        <div class="order-card">
          <div class="order-header">
            <span class="order-id">Commande #{{ order.id_order }}</span>
            <span class="order-date">{{ order.date_order | date:'dd/MM/yyyy HH:mm' }}</span>
            <span class="order-status" [class]="'status-' + order.status">
                  {{ order.status }}
                </span>
          </div>

          <div class="order-details">
            @for (detail of order.orderDetails; track detail.id_order_detail) {
              <div class="order-item">
                <span>{{ detail.product.name }}</span>
                <span>{{ detail.quantity }}x</span>
                <span>{{ detail.unit_price | currency:'EUR' }}</span>
                <span>{{ detail.quantity * detail.unit_price | currency:'EUR' }}</span>
              </div>
            }
          </div>

          <div class="order-footer">
            <div class="order-total">
              Total: {{ calculateOrderTotal(order) | currency:'EUR' }}
            </div>

            @if (isAdmin) {
              <div class="admin-actions">
                <select
                  [(ngModel)]="order.status"
                  (change)="updateOrderStatus(order.id_order, order.status)"
                  class="status-select"
                >
                  <option value="pending">En attente</option>
                  <option value="processing">En cours</option>
                  <option value="shipped">Expédiée</option>
                  <option value="delivered">Livrée</option>
                  <option value="cancelled">Annulée</option>
                </select>
              </div>
            }
          </div>
        </div>
      }
    </div>
  }
</div>
