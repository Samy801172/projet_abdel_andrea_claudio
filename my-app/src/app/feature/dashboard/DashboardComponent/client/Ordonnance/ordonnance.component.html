<div class="upload-prescription-container">
  <!-- Titre principal -->
  <h2>Mes ordonnances</h2>

  <!-- Bouton pour afficher/masquer le formulaire -->
  <button class="toggle-form-btn" (click)="toggleForm()">
    {{ showForm ? 'Annuler' : 'Uploader une ordonnance' }}
  </button>

  <!-- Formulaire d'upload (caché par défaut) -->
  <form *ngIf="showForm" (submit)="onUpload()">

    <!-- Sélection du fichier à uploader -->
    <div class="form-group">
      <label for="file">Fichier (JPEG, PNG, PDF) :</label>
      <input
        id="file"
        type="file"
        (change)="onFileSelected($event)"
      accept=".jpg,.jpeg,.png,.pdf"
      required
      />
    </div>

    <!-- Nom du médecin prescripteur -->
    <div class="form-group">
      <label for="prescribed_by">Prescrit par :</label>
      <input
        id="prescribed_by"
        type="text"
        [(ngModel)]="prescriptionDetails.prescribed_by"
      placeholder="Nom du médecin"
      name="prescribed_by"
      required
      />
    </div>

    <!-- Détails du médicament prescrit -->
    <div class="form-group">
      <label for="medication_details">Détails du médicament :</label>
      <input
        id="medication_details"
        type="text"
        [(ngModel)]="prescriptionDetails.medication_details"
      placeholder="Détails du médicament"
      name="medication_details"
      required
      />
    </div>

    <p class="paraAttention">*Attention la date de validité est de 7 jours</p>

    <!-- Bouton de soumission, désactivé si aucun fichier n'est sélectionné -->
    <button type="submit" [disabled]="!selectedFile">Uploader</button>
  </form>

  <hr />

  <!-- Section affichant la liste des ordonnances uploadées -->
  <div class="uploaded-prescriptions-container">
    <h3>Mes ordonnances</h3>

    <!-- Liste des ordonnances si disponible -->
    <ul *ngIf="uploadedPrescriptions && uploadedPrescriptions.length > 0">
      <li *ngFor="let prescription of uploadedPrescriptions" class="uploaded-prescription-item">

        <div class="file-info">
          <!-- Lien vers le fichier de l'ordonnance -->
          <p><strong>Fichier :</strong>
            <a [href]="'http://localhost:2024' + prescription.file_url" target="_blank">
              Voir l'ordonnance
            </a>
          </p>

          <!-- Informations sur l'ordonnance -->
          <p><strong>Prescrit par :</strong> {{ prescription.prescribed_by }}</p>
          <p><strong>Détails :</strong> {{ prescription.medication_details }}</p>
          <p><strong>Date d'expiration :</strong> {{ prescription.expiry_date | date:'dd/MM/yyyy' }}</p>

          <!-- Statut de l'ordonnance avec classe CSS dynamique -->
          <p
            class="status"
            [ngClass]="{
                  'PENDING': prescription.status === 'PENDING',
                  'VERIFIED': prescription.status === 'VERIFIED',
                  'REJECTED': prescription.status === 'REJECTED',
                  'EXPIRED': prescription.status === 'EXPIRED'
                }">
            <strong>Status :</strong> {{ getStatusLabel(prescription.status) }}
          </p>
        </div>

      </li>
    </ul>

    <!-- Message si aucune ordonnance n'a été uploadée -->
    <p *ngIf="!uploadedPrescriptions || uploadedPrescriptions.length === 0">Aucune ordonnance n'a été uploadée.</p>
  </div>
</div>
